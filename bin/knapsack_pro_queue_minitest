#!/bin/bash

CI_BUILD_ID=$(openssl rand -base64 32)

# you can test running only minitest spec file to see if spec syntax works for minitest
#KNAPSACK_PRO_TEST_FILE_LIST=test/minitest/meme_spec_test.rb \
KNAPSACK_PRO_RSPEC_DISABLED=true \
  RAILS_ENV=test \
  KNAPSACK_PRO_ENDPOINT=http://api.knapsackpro.test:3000 \
  KNAPSACK_PRO_TEST_SUITE_TOKEN_MINITEST=a1d15e9837f9a4b8ec8eb5477048607a \
  KNAPSACK_PRO_REPOSITORY_ADAPTER=git \
  KNAPSACK_PRO_PROJECT_DIR=. \
  KNAPSACK_PRO_CI_NODE_TOTAL=${2:-2} \
  KNAPSACK_PRO_CI_NODE_INDEX=${1:-0} \
  KNAPSACK_PRO_CI_NODE_BUILD_ID=${3:-$CI_BUILD_ID} \
  bundle exec rake knapsack_pro:queue:minitest[--verbose]
